/******************************************************************************
 * This file is part of Interdiode                                            *
 *                                                                            *
 * Copyright (C) 2020 Matthieu Gallet <matthieu.gallet@19pouces.net>          *
 * All Rights Reserved                                                        *
 *                                                                            *
 ******************************************************************************/

!function(e){var t={};function n(o){if(t[o])return t[o].exports;var l=t[o]={i:o,l:!1,exports:{}};return e[o].call(l.exports,l,l.exports,n),l.l=!0,l.exports}n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var l in e)n.d(o,l,function(t){return e[t]}.bind(null,l));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){n(1),n(2),e.exports=n(3)},function(e,t){DFSignals={connection:null,buffer:[],registry:{},wsurl:null},document.addEventListener("DOMContentLoaded",(function e(){if(null===DFSignals.wsurl){const e=function(e){const t=e+"=";console.info(document.cookie);const n=decodeURIComponent(document.cookie);console.info(n);const o=n.split(";");for(let e=0;e<o.length;e++){let n=o[e];for(;" "===n.charAt(0);)n=n.substring(1);if(0===n.indexOf(t))return n.substring(t.length,n.length)}return""}("dfwsurl");console.info(e),DFSignals.wsurl=decodeURIComponent(e),console.warn(DFSignals.wsurl)}const t=new WebSocket(DFSignals.wsurl);t.onopen=()=>{DFSignals.connection=t;for(let e=0;e<DFSignals.buffer.length;e++)t.send(DFSignals.buffer[e]);DFSignals.buffer=[]},t.onmessage=e=>{console.debug("received call "+e.data+" from server.");const t=JSON.parse(e.data);t.signal&&t.signal_id&&DFSignals.call(t.signal,t.opts,t.signal_id)},t.onerror=e=>{console.error("WS error: "+e)},t.onclose=()=>{DFSignals.connection=null,setTimeout(e,3e3)}})),DFSignals.call=function(e,t,n){if(void 0!==n&&void 0!==DFSignals.registry[n])return!1;if(void 0!==n&&(DFSignals.registry[n]=!0),void 0!==DFSignals.registry[e]){console.debug('call "'+e+'"',t);for(let o=0;o<DFSignals.registry[e].length;o+=1)DFSignals.registry[e][o](t,n)}if(void 0===n){console.debug('call from client: "'+e+'"',t);const n=JSON.stringify({signal:e,opts:t});DFSignals.connection?DFSignals.connection.send(n):DFSignals.buffer.push(n)}return!1},DFSignals.connect=function(e,t){void 0===DFSignals.registry[e]&&(DFSignals.registry[e]=[]),DFSignals.registry[e].push(t)}},function(e,t){document.addEventListener("DOMContentLoaded",(function(){DFSignals.connect("html.add_class",e=>{document.querySelectorAll(e.selector).forEach(t=>{t.classList.add(e.class_name)})}),DFSignals.connect("html.after",e=>{document.querySelectorAll(e.selector).forEach(t=>{t.insertAdjacentElement("afterend",e.content)})}),DFSignals.connect("html.append",e=>{document.querySelectorAll(e.selector).forEach(t=>{t.append(e.content)})}),DFSignals.connect("html.before",e=>{document.querySelectorAll(e.selector).forEach(t=>{t.insertAdjacentElement("beforebegin",e.content)})}),DFSignals.connect("html.empty",e=>{document.querySelectorAll(e.selector).forEach(e=>{for(;e.firstChild;)e.removeChild(e.firstChild)})}),DFSignals.connect("html.prepend",e=>{document.querySelectorAll(e.selector).forEach(t=>{t.insertBefore(e.content,parent.firstChild)})}),DFSignals.connect("html.remove",e=>{document.querySelectorAll(e.selector).forEach(e=>{e.parentNode.removeChild(e)})}),DFSignals.connect("html.remove_attr",e=>{document.querySelectorAll(e.selector).forEach(t=>{t.removeAttribute(e.attr_name)})}),DFSignals.connect("html.remove_class",e=>{document.querySelectorAll(e.selector).forEach(t=>{t.classList.remove(e.class_name)})}),DFSignals.connect("html.replace_with",e=>{document.querySelectorAll(e.selector).forEach(t=>{t.outerHTML=e.content})}),DFSignals.connect("html.add_attribute",e=>{document.querySelectorAll(e.selector).forEach(t=>{t.setAttribute(e.attr_name,e.attr_value)})}),DFSignals.connect("html.content",e=>{document.querySelectorAll(e.selector).forEach(t=>{t.innerHTML=e.content})}),DFSignals.connect("html.text",e=>{document.querySelectorAll(e.selector).forEach(t=>{t.textContent=e.content})}),DFSignals.connect("html.download_file",e=>{const t=document.createElement("a");t.href=e.url,t.target="_blank",t.download=e.filename||"unknown";const n=new MouseEvent("click",{view:window,bubbles:!0,cancelable:!1});t.dispatchEvent(n),(window.URL||window.webkitURL).revokeObjectURL(t.href)}),DFSignals.connect("html.focus",e=>{const t=document.querySelector(e.selector);t&&t.focus()})}))},function(e,t,n){"use strict";function o(e){const t=[];for(let n=0;n<e.elements.length;n++){const o=e.elements[n];if(o.name&&!o.disabled&&"reset"!==o.type&&"submit"!==o.type&&"button"!==o.type)if("file"===o.type)for(let e=0;e<o.files.length;e++)t.push({name:o.name,value:o.files[e].name});else if("select-multiple"===o.type)for(let e=0;e<o.selectedOptions.length;e++)t.push({name:o.name,value:o.selectedOptions[e].value});else("checkbox"!==o.type&&"radio"!==o.type||o.checked)&&t.push({name:o.name,value:o.value})}return t}n.r(t),n.d(t,"serializeForm",(function(){return o})),document.addEventListener("DOMContentAdded",e=>{window.setTimeout(()=>{!function(e){e.target.querySelectorAll("[data-df-signal]").forEach(e=>{JSON.parse(e.getAttribute("data-df-signal")).forEach(t=>{let n=t.on;n||(n="FORM"===e.tagName?"submit":"INPUT"===e.tagName&&"reset"!==e.type&&"submit"!==e.type&&"button"!==e.type||"TEXTAREA"===e.tagName?"change":"click");e.addEventListener(n,l=>{const r=t.prevent,c=t.opts||{};if(t.form&&(c[t.form]=o(e)),t.value)if("file"===e.type){c[t.value]=[];for(let n=0;n<e.files.length;n++)c[t.value].push(e.files[n].name)}else if("select-multiple"===e.type){c[t.value]=[];for(let n=0;n<e.selectedOptions.length;n++)c[t.value].push(e.selectedOptions[n].value)}else"checkbox"===e.type||"radio"===e.type?c[t.value]=e.checked:c[t.value]=e.value;DFSignals.call(t.name,c),(!0===r||null===r&&"change"!==n)&&l.preventDefault()})})})}(e)},200)})}]);
//# sourceMappingURL=df_websockets.min.js.map